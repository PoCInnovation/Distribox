#cloud-config

# Nom d'hôte (peut aussi être mis dans meta-data, mais fonctionne ici)
hostname: distribox
fqdn: distribox.local

# Configuration des utilisateurs
users:
  - name: user
    groups: sudo
    shell: /bin/bash
    sudo: ["ALL=(ALL) NOPASSWD:ALL"]

# Définition des mots de passe
chpasswd:
  list: |
    user:password
  expire: false
ssh_pwauth: true

package_update: true
package_upgrade: true
packages:
  - qemu-guest-agent
  - xubuntu-desktop
  - vim
package_reboot_if_required: false

runcmd:
  - apt clean
  - apt autoremove -y
  - rm -rf /var/log/*
  - rm -rf /tmp/*
  - rm -rf /var/cache/apt/archives/*
  - rm -rf /var/lib/systemd/coredump/*
  - dd if=/dev/zero of=/EMPTY bs=1M || true
  - rm -f /EMPTY
  - sync
  - shutdown -h now
